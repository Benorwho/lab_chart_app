<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lab Chart App</title>
  <link rel="stylesheet" href="styles.css" />

  <!-- Plotly is a single dependency. Pin a version for stability. -->
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
</head>

<body>
  <header class="topbar">
    <div class="topbar_inner">
      <div class="brand">
        <div class="brand_title">Lab Chart App</div>
        <div class="brand_subtitle">Paste or upload data, compute mean and error bars, export publication figures</div>
      </div>
      <div class="topbar_actions">
        <button id="btnClear" class="btn btn_ghost" type="button">Clear data</button>
      </div>
    </div>
  </header>

  <main class="app">
    <aside class="sidebar">
      <section class="panel">
        <h2>Data input</h2>

        <div class="row">
          <label class="label" for="fileInput">Upload CSV</label>
          <input id="fileInput" type="file" accept=".csv,text/csv" />
          <div class="hint">Nothing is uploaded anywhere. Files stay in your browser memory.</div>
        </div>

        <div class="row">
          <label class="label" for="pasteArea">Or paste CSV or TSV</label>
          <textarea id="pasteArea" rows="8" placeholder="Paste a header row and data rows here"></textarea>
        </div>

        <div class="row row_inline">
          <button id="btnParse" class="btn" type="button">Parse data</button>
          <button id="btnLoadExample" class="btn btn_ghost" type="button">Load example</button>
        </div>

        <div id="messages" class="messages" aria-live="polite"></div>
      </section>

      <section class="panel">
        <h2>Columns</h2>

        <div class="row">
          <div class="grid2">
            <div>
              <label class="label" for="colId">ID column</label>
              <select id="colId"></select>
            </div>
            <div>
              <label class="label" for="colTime">Time column (optional)</label>
              <select id="colTime"></select>
            </div>
          </div>
        </div>

        <div class="row">
          <label class="label" for="colCondition">Condition column (optional)</label>
          <select id="colCondition"></select>
        </div>

        <div class="row">
          <div class="label">Replicate columns</div>
          <div id="replicateList" class="checklist"></div>
          <div class="hint">Auto detected by names like iterate 1, iter2, rep 3, replicate_4, r5. You can override.</div>
        </div>

        <div class="row row_inline">
          <button id="btnCompute" class="btn" type="button" disabled>Compute stats</button>
          <button id="btnDownloadProcessed" class="btn btn_ghost" type="button" disabled>Download processed CSV</button>
        </div>
      </section>

      <section class="panel">
        <h2>Chart</h2>

        <div class="row">
          <label class="label" for="chartType">Chart type</label>
          <select id="chartType">
            <option value="bar">Bar with error bars</option>
            <option value="scatter">Scatter</option>
            <option value="line">Line</option>
          </select>
        </div>

        <div class="row">
          <div class="grid2">
            <div>
              <label class="label" for="xMode">X axis</label>
              <select id="xMode"></select>
            </div>
            <div>
              <label class="label" for="groupMode">Group</label>
              <select id="groupMode">
                <option value="none">None</option>
                <option value="condition">Condition</option>
                <option value="id">ID</option>
              </select>
            </div>
          </div>
          <div class="hint">Bar charts usually work best with group set to Condition when you have it.</div>
        </div>

        <div class="row">
          <div class="grid2">
            <div>
              <label class="label" for="errorMode">Error bars</label>
              <select id="errorMode">
                <option value="sem">SEM</option>
                <option value="sd">SD</option>
                <option value="none">None</option>
              </select>
            </div>
            <div class="toggleRow">
              <input id="toggleRaw" type="checkbox" />
              <label for="toggleRaw">Overlay raw replicates</label>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="grid2">
            <div class="toggleRow">
              <input id="toggleGrid" type="checkbox" checked />
              <label for="toggleGrid">Gridlines</label>
            </div>
            <div class="toggleRow">
              <input id="toggleLegend" type="checkbox" checked />
              <label for="toggleLegend">Legend</label>
            </div>
          </div>
        </div>

        <div class="row">
          <label class="label">Filter</label>
          <div class="grid2">
            <div>
              <label class="label_sub" for="filterIds">IDs</label>
              <select id="filterIds" multiple size="5"></select>
            </div>
            <div>
              <label class="label_sub" for="filterConditions">Conditions</label>
              <select id="filterConditions" multiple size="5"></select>
            </div>
          </div>
          <div class="hint">Leave empty to include all.</div>
        </div>

        <div class="row row_inline">
          <button id="btnRender" class="btn" type="button" disabled>Render chart</button>
          <button id="btnResetView" class="btn btn_ghost" type="button" disabled>Reset view</button>
        </div>
      </section>

      <section class="panel">
        <h2>Style</h2>

        <div class="row">
          <label class="label" for="theme">Theme</label>
          <select id="theme">
            <option value="light">Clean light</option>
            <option value="dark">Dark</option>
          </select>
        </div>

        <div class="row">
          <label class="label" for="title">Chart title</label>
          <input id="title" type="text" placeholder="Optional" />
        </div>

        <div class="row">
          <div class="grid2">
            <div>
              <label class="label" for="xTitle">X title</label>
              <input id="xTitle" type="text" placeholder="Optional" />
            </div>
            <div>
              <label class="label" for="yTitle">Y title</label>
              <input id="yTitle" type="text" placeholder="Mean" />
            </div>
          </div>
        </div>

        <div class="row">
          <div class="grid2">
            <div>
              <label class="label" for="fontSize">Font size</label>
              <input id="fontSize" type="number" min="8" max="28" value="14" />
            </div>
            <div>
              <label class="label" for="markerSize">Marker size</label>
              <input id="markerSize" type="number" min="2" max="24" value="7" />
            </div>
          </div>
        </div>

        <div class="row">
          <div class="grid2">
            <div>
              <label class="label" for="lineWidth">Line width</label>
              <input id="lineWidth" type="number" min="1" max="10" value="2" />
            </div>
            <div>
              <label class="label" for="errorWidth">Error width</label>
              <input id="errorWidth" type="number" min="1" max="10" value="2" />
            </div>
          </div>
        </div>

        <div class="row">
          <div class="grid2">
            <div>
              <label class="label" for="capSize">Cap size</label>
              <input id="capSize" type="number" min="0" max="20" value="6" />
            </div>
            <div>
              <label class="label" for="legendPos">Legend position</label>
              <select id="legendPos">
                <option value="right">Right</option>
                <option value="bottom">Bottom</option>
                <option value="top">Top</option>
                <option value="left">Left</option>
              </select>
            </div>
          </div>
        </div>
      </section>

      <section class="panel">
        <h2>Export</h2>

        <div class="row">
          <div class="grid2">
            <button id="btnExportSvg" class="btn btn_ghost" type="button" disabled>Export SVG</button>
            <button id="btnExportPng" class="btn btn_ghost" type="button" disabled>Export PNG</button>
          </div>
          <div class="row">
            <label class="label_sub" for="pngScale">PNG resolution</label>
            <select id="pngScale">
              <option value="1">1x</option>
              <option value="2" selected>2x</option>
              <option value="3">3x</option>
              <option value="4">4x</option>
            </select>
            <div class="hint">Higher values create larger images, good for slides.</div>
          </div>
        </div>
      </section>
    </aside>

    <section class="main">
      <div class="chartWrap">
        <div id="chart" class="chart"></div>
        <div id="emptyState" class="emptyState">
          <div class="emptyTitle">No chart yet</div>
          <div class="emptyText">Paste or upload data, compute stats, then render.</div>
        </div>
      </div>

      <section class="panel panel_main">
        <h2>Processed preview</h2>
        <div class="tableWrap">
          <table id="previewTable">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
    </section>
  </main>

  <footer class="footer">
    <div class="footer_inner">
      <div>Client side only. Nothing is stored unless you download files.</div>
    </div>
  </footer>

  <script src="app.js"></script>
</body>
</html>
